需要修改的数据库信息，登录名，密码，库名，`user`，`passwd`，`databasename`

命令行解析，getopt()，设置模式`config`

WebServer类`server`声明，初始化http_conn类对象`users`，大小为最大文件描述符65536，getcwd()获得当前路径，缓冲区大小为200，当前路径加上"/root"，设置root文件路径`m_root`，初始化client_data定时器类对象`user_timer`，大小为最大文件描述符65536

server.init()初始化，使用`config`参数

server.log_write()创建日志文件，选择是否写日志`m_close_log`，选择**同步写入日志**或者**异步写入日志**`m_log_write`，**同步和异步通过设置阻塞队列长度区分**，异步需要设置阻塞队列的长度，同步设置长度为0，局部变量懒汉单例模式初始化，设置文件名`file_name`为"./ServerLog"，日志缓冲区大小`m_log_buf_size`为2000，日志最大行数`m_split_lines`为800000，阻塞队列长度`max_queue_size`同步为0异步为800，**循环数组模拟生产者消费者模型实现阻塞队列**，为了线程安全需要加互斥锁，当是异步写入，创建线程使用回调函数异步写入日志，回调函数实现从阻塞队列中取出一个日志string，如果当前队列没有元素，将会等待条件变量，fputs()写入文件，得到当前时间，有路径文件路径为"路径，年月日，`file_name`后缀"，没有路径文件路径为"年月日，`file_name`"，fopen以附加的方式打开只写文件，若文件不存在，则会创建该文件；如果文件存在，则写入的数据会被加到文件尾后，文件原先的内容会被保留

server.sql_pool()创建数据库连接池，**单例模式初始化数据库连接池**，用**双向链表list维护数据库连接**，创建对应数量数据库连接，出错要写日志，users初始化数据库读取表，从连接池中取一个连接使用RAII机制，在user表中检索用户名和密码，使用map<string,string>维护用户名和密码，**将对应的用户名和密码存入map**

server.thread_pool()创建线程池，创建对应数量线程，并对线程分离，出错抛出异常，回调函数处理请求队列任务，**用双向链表list维护请求队列**，**并发模型可以选择proactor和reactor**，当选择reactor模式，使用m_state区分读和写，读任务可以在LT模式和ET模式，循环读取客户数据，直到读完或者对方关闭连接，在非阻塞ET模式下需要将数据一次读完，使用recv接收读缓冲区中的数据，取出数据库连接，读取读缓冲区中的数据并且处理，**使用主从状态机解析http请求，从状态机用于分析出一行内容，主状态机用于解析一行意义**，生成http响应，如果是注册，先检测数据库中是否有重名，没有重名增加数据，如果是登录，直接判断，以只读方式获取文件描述符，通过mmap将该文件映射到内存中，向写缓冲区写入对应http响应，使用writev将http响应发送出去，**需要设置EPOLLONESHOT事件**，如果是申请长连接，则重新初始化HTTP对象，当选择proactor模式，取出数据库连接，处理http请求和响应数据

server.trig_mode()设置触发模式，**监听和连接socket都可以选择LT模式和ET模式**

server.eventListen()监听，创建socket，选择是否优雅关闭，设置socket文件描述符，bind绑定端口，listen监听端口，初始化定时器，epoll创建内核事件表，添加监听事件，设置非阻塞，创建管道套接字，设置管道写端非阻塞，读端非阻塞，**统一事件源**，添加监听事件，忽略信号值SIGPIPE，监听信号值SIGALRM和SIGTERM，每隔TIMESLOT时间触发SIGALRM信号

server.eventLoop()运行，epoll等待事件触发，出错要写日志，轮询有事件产生的文件描述符，如果是监听文件描述符，处理新到的客户连接，选择LT模式和ET模式accept接受连接，出错要写日志，使用send发送出错信息，设置定时器，**使用升序双向链表维护定时器**，时间到了删除事件，关闭文件描述符，减少连接数，超时时间设置为3 * TIMESLOT，如果是出错事件，关闭连接，移除定时器，如果管道读端发生读事件，因为统一事件源，信号处理当成读事件处理，使用recv接收信号值，并且处理信号值，出错要写日志，如果是读事件，调整定时器，将读事件放入请求队列，或者读入了再放入请求队列，需要移除定时器，如果是写事件，调整定时器，将写事件放入请求队列，或者写入了再放入请求队列，需要移除定时器，当时间到了处理事件，删除节点，超时写入日志