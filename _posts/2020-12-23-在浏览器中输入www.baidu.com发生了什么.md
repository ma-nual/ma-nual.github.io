---
layout:     post
published:  true
title:      "在浏览器中输入www.baidu.com发生了什么"
subtitle:   "计算机网络笔记"
date:       2020-12-23 19:00:00
author:     "Manual"
header-img: "img/post-bg-2015.jpg"
catalog: true
tags:
    - 计算机网络
---

> 本文介绍了在浏览器中输入www.baidu.com发生的事情和涉及的协议

## 过程

### 详细版：

**1.**  首先是域名解析，客户端使用DNS协议将URL解析为对应的IP地址

**2.**  客户端浏览器发起HTTP会话请求

**3.**  客户端与服务器建立TCP连接（三次握手），把HTTP会话请求分割成报文段添加源和目的端口封装成数据包，然后使用IP层的IP地址查找目的端，把每个报文段可靠地传给目的IP地址，如服务器使用80端口监听客户端的请求，客户端由系统随机选择一个端口如5000 ，与服务器进行交换，服务器把相应的请求返回给客户端的5000端口

**4.**  客户端的网络层通过查找路由表确定如何到达服务器（选路和转发），期间可能经过多个路由器，路由器依据IP地址和路由表选择路径，把数据包送达IP地址所对应的服务器

**5.**  客户端的数据链路层，通过ARP协议查找下一跳的IP地址对应的MAC地址，发送ARP请求报文，如果得到回应，就可以使用MAC地址发送MAC帧，最终可以发送IP数据报到服务器

**6.**  服务器收到数据包的HTTP会话请求，TCP按序号重组到达的报文段，HTTP对Web服务器请求的内容进行处理，服务器通过HTTP响应把首页文件发送给浏览器

**7.**  TCP连接释放，Web服务器关闭TCP连接，一般情况下，一旦Web服务器向浏览器发送了请求数据，它就要关闭TCP连接，然后如果浏览器或者服务器在其头信息加入了这行代码：Connection:keep-alive TCP连接在发送后将仍然保持打开状态，于是浏览器可以继续通过相同的连接发送请求，保持连接节省了为每个请求建立新连接所需的时间，还节约了网络带宽

**8.**  浏览器将首页文件进行解析，并将Web页显示给用户（回来的时候也是依据浏览器的IP地址才能将包裹正确送达，浏览器得到html代码，浏览器解析html代码，并请求html代码中的资源，如js、css、图片等，浏览器对页面进行渲染呈现给用户）

### 精简版：

**1.**  首先是域名解析，客户端使用DNS协议将URL解析为对应的IP地址

**2.**  然后建立TCP连接，客户端与服务器通过三次握手建立TCP连接

**3.**  接着是http连接，客户端向服务器发送http连接请求（http连接无需额外连接，直接通过已经建立的TCP连接发送）

**4.**  服务器对客户端发来的http请求进行处理，并返回响应

**5.**  客户端接收到http响应，将结果渲染展示给用户

## 涉及协议

**(1) 应用层：**HTTP，DNS（域名解析服务）

DNS解析域名为目的IP，通过IP找到服务器路径，客户端向服务器发起HTTP会话，然后通过运输层TCP协议封装数据包，在TCP协议基础上进行传输

**(2) 传输层：**TCP（为HTTP提供可靠的数据传输），UDP（DNS使用UDP传输）

HTTP会话会被分成报文段，添加源、目的端口，TCP协议进行主要工作

**(3) 网络层：**IP（IP数据数据包传输和路由选择），ICMP（提供网络传输过程中的差错检测）

为数据包选择路由，IP协议进行主要工作，相邻结点的可靠传输

**(4) 数据链路层：**ARP（将本机的默认网关IP地址映射成物理MAC地址）

ARP协议将IP地址转成MAC地址